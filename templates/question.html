{% extends "base.html" %}

{% block content %}
<h2 class="text-center mb-4"></h2>
<p class="text-center">ã“ã®å†™çœŸã®ã©ã“ã‚’è¦‹ã‚‹ã¨ï¼Œã“ã®äººãŒä»Šã©ã“ã«ã„ã‚‹ã®ã‹æ¨æ¸¬ã§ãã‚‹ã‹ãªï¼Ÿ</p>

<div class="row justify-content-center">
    <div class="col-md-5 text-center">
        <h5>ï¼ˆæ€ªã—ã„å ´æ‰€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã¿ã‚ˆã†ï¼ï¼‰</h5>
        <div class="position-relative">
            <img src="{{ url_for('static', filename=data.image_phishing) }}" id="phishingImage" class="img-fluid border" alt="å½ã‚µã‚¤ãƒˆ">
            <canvas id="clickCanvas" class="position-absolute top-0 start-0" style="pointer-events: none;"></canvas>
        </div>
    </div>
</div>

<p id="resultMessage" class="text-center mt-4 fs-5"></p>

<script>
    const differences = {{ data.differences | tojson }};
    const image = document.getElementById("phishingImage");
    const canvas = document.getElementById("clickCanvas");
    const ctx = canvas.getContext("2d");
    const resultMessage = document.getElementById("resultMessage");

    image.onload = function () {
        canvas.width = image.clientWidth;
        canvas.height = image.clientHeight;
    };

    image.addEventListener("click", function (e) {
        const rect = image.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        let found = false;
        for (const diff of differences) {
            const dx = x - diff.x;
            const dy = y - diff.y;
            if (Math.sqrt(dx * dx + dy * dy) <= diff.radius) {
                found = true;
                break;
            }
        }

        if (found) {
            resultMessage.innerText = "ğŸ¯ æ­£è§£ï¼é–“é•ã„ã‚’è¦‹ã¤ã‘ã¾ã—ãŸï¼";
            resultMessage.classList.remove("text-danger");
            resultMessage.classList.add("text-success");
        } else {
            resultMessage.innerText = "âŒ æ®‹å¿µã€ä¸æ­£è§£ã§ã™â€¦";
            resultMessage.classList.remove("text-success");
            resultMessage.classList.add("text-danger");
        }

        // ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã‚’å††ã§è¡¨ç¤º
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.arc(x, y, 10, 0, 2 * Math.PI);
        ctx.strokeStyle = found ? "green" : "red";
        ctx.lineWidth = 3;
        ctx.stroke();
    });
</script>
{% endblock %}
